<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Ahorcado Pro con Tiempo Ajustable</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(120deg, #1f2933, #0f172a);
            color: white;
            text-align: center;
            min-height: 100vh;
            padding: 30px;
            transition: background 0.5s;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* Marco principal del juego */
        .game-frame {
            background: rgba(0, 0, 0, 0.4);
            border: 3px solid;
            border-image: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706, #fbbf24) 1;
            border-radius: 0;
            padding: 30px 40px;
            max-width: 700px;
            width: 100%;
            position: relative;
            box-shadow:
                0 0 30px rgba(251, 191, 36, 0.3),
                inset 0 0 60px rgba(0, 0, 0, 0.5);
        }

        .game-frame::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706, #b45309);
            z-index: -1;
            border-radius: 5px;
        }

        .game-frame::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            border-radius: 2px;
            z-index: -1;
        }

        h1 {
            margin-bottom: 15px;
            font-size: 2em;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* Panel de estad√≠sticas */
        #stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.95em;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-item.racha {
            border-color: #fbbf24;
            color: #fbbf24;
        }

        /* Dificultad */
        #difficulty {
            margin-bottom: 15px;
        }

        #difficulty label {
            margin: 0 10px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            display: inline-block;
        }

        #difficulty label:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        #difficulty input[type="radio"] {
            margin-right: 5px;
        }

        /* Canvas */
        #hangman {
            border: 2px solid rgba(255, 255, 255, 0.3);
            margin: 15px auto;
            display: block;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        /* Palabra */
        #word {
            font-size: 2.5em;
            letter-spacing: 15px;
            margin: 20px;
            min-height: 60px;
        }

        #word span {
            display: inline-block;
            border-bottom: 3px solid #fff;
            min-width: 30px;
            margin: 0 5px;
            padding-bottom: 5px;
            transition: all 0.3s;
        }

        #word span.revealed {
            animation: revealLetter 0.4s ease-out;
            color: #4ade80;
        }

        @keyframes revealLetter {
            0% {
                transform: scale(1.5);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Teclado */
        #letters {
            max-width: 600px;
            margin: 0 auto 15px;
        }

        #letters button {
            margin: 4px;
            padding: 12px 16px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        #letters button:hover:not(:disabled) {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
        }

        #letters button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        #letters button.correct {
            background: linear-gradient(145deg, #22c55e, #16a34a);
            animation: correctPulse 0.3s;
        }

        #letters button.wrong {
            background: linear-gradient(145deg, #ef4444, #dc2626);
            animation: wrongShake 0.3s;
        }

        @keyframes correctPulse {
            50% {
                transform: scale(1.2);
            }
        }

        @keyframes wrongShake {
            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        /* Estado y mensajes */
        #status {
            margin: 15px 0;
            font-size: 1.5em;
            font-weight: bold;
            min-height: 40px;
        }

        #status.victoria {
            color: #4ade80;
            animation: victoriaAnim 0.5s ease-out;
        }

        #status.derrota {
            color: #f87171;
            animation: derrotaAnim 0.5s ease-out;
        }

        @keyframes victoriaAnim {
            0% {
                transform: scale(0);
            }

            50% {
                transform: scale(1.3);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes derrotaAnim {

            0%,
            100% {
                transform: rotate(0);
            }

            25% {
                transform: rotate(-5deg);
            }

            75% {
                transform: rotate(5deg);
            }
        }

        /* Info del juego */
        #game-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        #mistakes-left,
        #timer-display {
            font-size: 1.1em;
            color: #fbbf24;
        }

        /* Barra de progreso del timer */
        #timer-bar-container {
            width: 300px;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin: 10px auto;
            overflow: hidden;
        }

        #timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #fbbf24);
            border-radius: 10px;
            transition: width 0.5s linear, background 0.5s;
            width: 100%;
        }

        #timer-bar.warning {
            background: linear-gradient(90deg, #f97316, #ef4444);
        }

        #timer-bar.danger {
            background: #ef4444;
            animation: timerPulse 0.5s infinite;
        }

        @keyframes timerPulse {
            50% {
                opacity: 0.7;
            }
        }

        /* Botones principales */
        .game-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 25px;
            cursor: pointer;
            border: none;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
        }

        .btn-hint {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
        }

        .btn-hint:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Mensaje inicial */
        #intro-message {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 30px;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #intro-message h2 {
            margin-bottom: 15px;
            color: #fbbf24;
        }

        #intro-message ul {
            text-align: left;
            list-style: none;
            padding: 0;
        }

        #intro-message li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #intro-message li:last-child {
            border-bottom: none;
        }

        #intro-message li::before {
            content: "‚Üí ";
            color: #fbbf24;
        }

        /* Toggle sonido */
        #sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #fbbf24;
            color: #fbbf24;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
            z-index: 100;
        }

        #sound-toggle:hover {
            background: rgba(251, 191, 36, 0.2);
        }

        #sound-toggle.muted {
            border-color: #666;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 500px) {
            #word {
                font-size: 1.8em;
                letter-spacing: 10px;
            }

            #letters button {
                padding: 10px 12px;
                font-size: 14px;
            }

            h1 {
                font-size: 1.5em;
            }
        }

        /* Ocultar elementos */
        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <button id="sound-toggle" title="Activar/Desactivar sonido">üîä</button>

    <div class="game-frame">
        <h1>üéØ Ahorcado Pro ‚Äì Tiempo seg√∫n dificultad</h1>

        <!-- Estad√≠sticas -->
        <div id="stats">
            <div class="stat-item">üèÜ Victorias: <span id="wins">0</span></div>
            <div class="stat-item">üíÄ Derrotas: <span id="losses">0</span></div>
            <div class="stat-item racha">üî• Racha: <span id="streak">0</span></div>
        </div>

        <!-- Mensaje inicial -->
        <div id="intro-message">
            <h2>üìñ Instrucciones</h2>
            <ul>
                <li><strong>F√°cil:</strong> 8 errores, 90 segundos, palabras cortas</li>
                <li><strong>Normal:</strong> 6 errores, 60 segundos, palabras medianas</li>
                <li><strong>Dif√≠cil:</strong> 4 errores, 40 segundos, palabras largas</li>
                <li><strong>Pista:</strong> Revela una letra pero pierde 10 segundos</li>
            </ul>
        </div>

        <div id="difficulty">
            <strong>Dificultad:</strong>
            <label><input type="radio" name="level" value="8" checked> üü¢ F√°cil</label>
            <label><input type="radio" name="level" value="6"> üü° Normal</label>
            <label><input type="radio" name="level" value="4"> üî¥ Dif√≠cil</label>
        </div>

        <canvas id="hangman" width="200" height="250"></canvas>

        <div id="word"></div>
        <div id="letters"></div>
        <div id="status"></div>

        <div id="game-info" class="hidden">
            <div id="mistakes-left">Errores restantes: 6</div>
            <div id="timer-display">Tiempo: 60s</div>
        </div>

        <div id="timer-bar-container" class="hidden">
            <div id="timer-bar"></div>
        </div>

        <div class="game-buttons">
            <button class="btn btn-primary" id="start">‚ñ∂Ô∏è Iniciar Juego</button>
            <button class="btn btn-hint" id="hint" disabled>üí° Pista (-10s)</button>
            <button class="btn btn-secondary" id="restart" class="hidden">üîÑ Nuevo Juego</button>
        </div>
    </div> <!-- Cierre de game-frame -->

    <script>
        // Audio Context
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        let soundEnabled = true;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
        }

        function playSound(type) {
            if (!soundEnabled || !audioCtx) return;

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            switch (type) {
                case 'correct':
                    oscillator.frequency.setValueAtTime(523, audioCtx.currentTime);
                    oscillator.frequency.setValueAtTime(659, audioCtx.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'wrong':
                    oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'victory':
                    [523, 659, 784, 1047].forEach((freq, i) => {
                        const osc = audioCtx.createOscillator();
                        const gain = audioCtx.createGain();
                        osc.connect(gain);
                        gain.connect(audioCtx.destination);
                        osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.15);
                        gain.gain.setValueAtTime(0.2, audioCtx.currentTime + i * 0.15);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.15 + 0.2);
                        osc.start(audioCtx.currentTime + i * 0.15);
                        osc.stop(audioCtx.currentTime + i * 0.15 + 0.2);
                    });
                    break;
                case 'defeat':
                    oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.5);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.5);
                    break;
                case 'tick':
                    oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.05);
                    break;
                case 'hint':
                    oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                    oscillator.frequency.setValueAtTime(660, audioCtx.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
            }
        }

        // Toggle sonido
        document.getElementById('sound-toggle').addEventListener('click', function () {
            initAudio();
            soundEnabled = !soundEnabled;
            this.textContent = soundEnabled ? 'üîä' : 'üîá';
            this.classList.toggle('muted', !soundEnabled);
        });

        const canvas = document.getElementById("hangman");
        const ctx = canvas.getContext("2d");

        // Palabras por dificultad (sin tildes para simplificar)
        // FACIL: palabras cortas de 3-5 letras
        const easyWords = [
            "SOL", "LUZ", "PAN", "MAR", "PEZ", "OSO", "UVA", "REY", "TIO", "OJO",
            "PIE", "MES", "DOS", "UNO", "SAL", "TEN", "VER", "SER", "DAR", "VIA",
            "GATO", "PERRO", "CASA", "LUNA", "FLOR", "ARBOL", "MESA", "AGUA", "VACA", "PATO",
            "RANA", "NUBE", "SILLA", "LIBRO", "JUEGO", "BOLA", "ROJO", "AZUL", "VERDE", "NEGRO",
            "CAFE", "LECHE", "HUEVO", "QUESO", "CARNE", "FRUTA", "PAPA", "POLLO", "ARROZ", "SOPA"
        ];

        // NORMAL: palabras medianas de 6-10 letras
        const normalWords = [
            "ESCUELA", "CIENCIA", "HISTORIA", "TECLADO", "PANTALLA", "VENTANA", "MUSICAL", "PELICULA",
            "DEPORTE", "BALONCESTO", "FUTBOL", "NATACION", "GIMNASIO", "HOSPITAL", "MERCADO", "PARQUE",
            "FAMILIA", "HERMANO", "AMIGOS", "TRABAJO", "OFICINA", "EMPRESA", "NEGOCIO", "CLIENTE",
            "CELULAR", "MENSAJE", "CORREO", "CARPETA", "ARCHIVO", "DOCUMENTO", "PROYECTO", "REUNION",
            "COMIDA", "DESAYUNO", "ALMUERZO", "CENA", "BEBIDA", "POSTRE", "ENSALADA", "SANDWICH",
            "MONTA√ëA", "CASCADA", "BOSQUE", "DESIERTO", "OCEANO", "PLANETA", "ESTRELLA", "GALAXIA"
        ];

        // DIFICIL: palabras largas de 11+ letras
        const hardWords = [
            "MICROCONTROLADOR", "TELECOMUNICACIONES", "MICROPROCESADOR", "VIRTUALIZACION", "SINCRONIZACION",
            "CRIPTOGRAFIA", "PROGRAMACION", "ORDENADOR", "JAVASCRIPT", "ELECTRONICA", "MATEMATICAS",
            "ARQUITECTURA", "OPTIMIZACION", "ALGORITMO", "DESARROLLO", "INTERFACES", "COMPILADOR",
            "INFRAESTRUCTURA", "ADMINISTRACION", "CONFIGURACION", "ESPECIFICACION", "IMPLEMENTACION",
            "DOCUMENTACION", "COMUNICACION", "ORGANIZACION", "INVESTIGACION", "EXPERIMENTACION",
            "PROCESAMIENTO", "ALMACENAMIENTO", "RECONOCIMIENTO", "FUNCIONAMIENTO", "ESTABLECIMIENTO",
            "MANTENIMIENTO", "PROCEDIMIENTO", "CONOCIMIENTO", "ENTRENAMIENTO", "COMPORTAMIENTO",
            "DESCUBRIMIENTO", "ABASTECIMIENTO", "FORTALECIMIENTO", "PERFECCIONAMIENTO", "ENRIQUECIMIENTO",
            "ACONDICIONAMIENTO", "POSICIONAMIENTO", "ESTACIONAMIENTO", "CUESTIONAMIENTO", "APROVECHAMIENTO"
        ];

        // Estado del juego
        let selected = "";
        let guessed = [];
        let mistakes = 0;
        let maxMistakes = 6;
        let timer = 60;
        let maxTimer = 60;
        let timerInterval;
        let gameActive = false;

        // Estad√≠sticas
        let wins = parseInt(localStorage.getItem('ahorcado_wins') || '0');
        let losses = parseInt(localStorage.getItem('ahorcado_losses') || '0');
        let streak = parseInt(localStorage.getItem('ahorcado_streak') || '0');

        function updateStatsDisplay() {
            document.getElementById('wins').textContent = wins;
            document.getElementById('losses').textContent = losses;
            document.getElementById('streak').textContent = streak;
        }

        function saveStats() {
            localStorage.setItem('ahorcado_wins', wins);
            localStorage.setItem('ahorcado_losses', losses);
            localStorage.setItem('ahorcado_streak', streak);
        }

        // Fondo seg√∫n dificultad
        function setBackground(level) {
            if (level == 8) document.body.style.background = "linear-gradient(120deg,#1e3a8a,#2563eb)";
            if (level == 6) document.body.style.background = "linear-gradient(120deg,#c2410c,#ea580c)";
            if (level == 4) document.body.style.background = "linear-gradient(120deg,#991b1b,#7f1d1d)";
        }

        // Animaci√≥n de dibujo del ahorcado
        let animationQueue = [];

        function drawBase() {
            ctx.clearRect(0, 0, 200, 250);
            ctx.strokeStyle = "#fff";
            ctx.lineWidth = 3;
            ctx.lineCap = "round";

            // Base
            ctx.beginPath();
            ctx.moveTo(10, 240);
            ctx.lineTo(190, 240);
            ctx.stroke();

            // Poste vertical
            ctx.beginPath();
            ctx.moveTo(40, 240);
            ctx.lineTo(40, 20);
            ctx.stroke();

            // Poste horizontal
            ctx.beginPath();
            ctx.moveTo(40, 20);
            ctx.lineTo(120, 20);
            ctx.stroke();

            // Cuerda
            ctx.beginPath();
            ctx.moveTo(120, 20);
            ctx.lineTo(120, 40);
            ctx.stroke();
        }

        function animateHangmanPart(part) {
            const duration = 300;
            const startTime = performance.now();

            function animate(currentTime) {
                const progress = Math.min((currentTime - startTime) / duration, 1);

                // Limpiar y redibujar todo en cada frame
                ctx.clearRect(0, 0, 200, 250);

                // Redibujar la base
                ctx.strokeStyle = "#fff";
                ctx.lineWidth = 3;
                ctx.lineCap = "round";

                ctx.beginPath();
                ctx.moveTo(10, 240);
                ctx.lineTo(190, 240);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(40, 240);
                ctx.lineTo(40, 20);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(40, 20);
                ctx.lineTo(120, 20);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(120, 20);
                ctx.lineTo(120, 40);
                ctx.stroke();

                // Redibujar partes anteriores completamente
                for (let i = 1; i < part; i++) {
                    drawHangmanPartStatic(i);
                }

                // Animar la parte actual
                ctx.strokeStyle = "#fff";
                ctx.lineWidth = 3;
                ctx.beginPath();
                switch (part) {
                    case 1: // Cabeza
                        ctx.arc(120, 60, 20 * progress, 0, Math.PI * 2);
                        break;
                    case 2: // Cuerpo
                        ctx.moveTo(120, 80);
                        ctx.lineTo(120, 80 + 60 * progress);
                        break;
                    case 3: // Brazo izquierdo
                        ctx.moveTo(120, 95);
                        ctx.lineTo(120 - 30 * progress, 95 + 25 * progress);
                        break;
                    case 4: // Brazo derecho
                        ctx.moveTo(120, 95);
                        ctx.lineTo(120 + 30 * progress, 95 + 25 * progress);
                        break;
                    case 5: // Pierna izquierda
                        ctx.moveTo(120, 140);
                        ctx.lineTo(120 - 25 * progress, 140 + 40 * progress);
                        break;
                    case 6: // Pierna derecha
                        ctx.moveTo(120, 140);
                        ctx.lineTo(120 + 25 * progress, 140 + 40 * progress);
                        break;
                }
                ctx.stroke();

                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }

            requestAnimationFrame(animate);
        }

        // Funci√≥n auxiliar para dibujar una parte est√°tica (sin animaci√≥n)
        function drawHangmanPartStatic(part) {
            ctx.strokeStyle = "#fff";
            ctx.lineWidth = 3;
            ctx.beginPath();
            switch (part) {
                case 1: ctx.arc(120, 60, 20, 0, Math.PI * 2); break;
                case 2: ctx.moveTo(120, 80); ctx.lineTo(120, 140); break;
                case 3: ctx.moveTo(120, 95); ctx.lineTo(90, 120); break;
                case 4: ctx.moveTo(120, 95); ctx.lineTo(150, 120); break;
                case 5: ctx.moveTo(120, 140); ctx.lineTo(95, 180); break;
                case 6: ctx.moveTo(120, 140); ctx.lineTo(145, 180); break;
            }
            ctx.stroke();
        }

        function drawHangman() {
            for (let i = 1; i <= mistakes; i++) {
                ctx.strokeStyle = "#fff";
                ctx.lineWidth = 3;
                ctx.beginPath();
                switch (i) {
                    case 1: ctx.arc(120, 60, 20, 0, Math.PI * 2); break;
                    case 2: ctx.moveTo(120, 80); ctx.lineTo(120, 140); break;
                    case 3: ctx.moveTo(120, 95); ctx.lineTo(90, 120); break;
                    case 4: ctx.moveTo(120, 95); ctx.lineTo(150, 120); break;
                    case 5: ctx.moveTo(120, 140); ctx.lineTo(95, 180); break;
                    case 6: ctx.moveTo(120, 140); ctx.lineTo(145, 180); break;
                }
                ctx.stroke();
            }
        }

        // Selecci√≥n de palabra
        function selectWord() {
            const level = parseInt(document.querySelector('input[name="level"]:checked').value);
            setBackground(level);

            if (level === 8) {
                selected = easyWords[Math.floor(Math.random() * easyWords.length)];
                timer = maxTimer = 90;
            } else if (level === 6) {
                selected = normalWords[Math.floor(Math.random() * normalWords.length)];
                timer = maxTimer = 60;
            } else {
                selected = hardWords[Math.floor(Math.random() * hardWords.length)];
                timer = maxTimer = 40;
            }
            maxMistakes = level;
        }

        // Dibujar palabra
        function drawWord() {
            const wordDiv = document.getElementById("word");
            const currentContent = wordDiv.innerHTML;
            wordDiv.innerHTML = "";

            selected.split("").forEach((letter, index) => {
                const span = document.createElement("span");
                const isRevealed = guessed.includes(letter);
                span.textContent = isRevealed ? letter : "";

                // Animaci√≥n si es nueva letra revelada
                if (isRevealed && !currentContent.includes(`>${letter}<`)) {
                    span.classList.add('revealed');
                }

                wordDiv.appendChild(span);
            });
        }

        // Crear teclado con √ë
        function createLetters() {
            const lettersDiv = document.getElementById("letters");
            lettersDiv.innerHTML = "";

            // A-Z + √ë
            const letters = "ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ";

            letters.split("").forEach(letter => {
                const btn = document.createElement("button");
                btn.textContent = letter;
                btn.onclick = () => {
                    initAudio();
                    guess(letter, btn);
                };
                lettersDiv.appendChild(btn);
            });
        }

        // Manejar intento
        function guess(letter, btn) {
            if (!gameActive) return;

            btn.disabled = true;

            if (selected.includes(letter)) {
                guessed.push(letter);
                btn.classList.add("correct");
                playSound('correct');
            } else {
                mistakes++;
                btn.classList.add("wrong");
                playSound('wrong');
                drawBase();
                animateHangmanPart(mistakes);
            }

            drawWord();
            checkGame();
            updateMistakesLeft();
        }

        // Actualizar errores
        function updateMistakesLeft() {
            const left = Math.max(0, maxMistakes - mistakes);
            document.getElementById("mistakes-left").textContent = "Errores restantes: " + left;
        }

        // Actualizar barra de tiempo
        function updateTimerBar() {
            const bar = document.getElementById("timer-bar");
            const percentage = (timer / maxTimer) * 100;
            bar.style.width = percentage + "%";

            bar.classList.remove('warning', 'danger');
            if (percentage <= 20) {
                bar.classList.add('danger');
            } else if (percentage <= 40) {
                bar.classList.add('warning');
            }
        }

        // Timer
        function startTimer() {
            clearInterval(timerInterval);
            document.getElementById("timer-display").textContent = "Tiempo: " + timer + "s";
            updateTimerBar();

            timerInterval = setInterval(() => {
                timer--;
                document.getElementById("timer-display").textContent = "Tiempo: " + timer + "s";
                updateTimerBar();

                // Sonido de advertencia en √∫ltimos 10 segundos
                if (timer <= 10 && timer > 0) {
                    playSound('tick');
                }

                if (timer <= 0) {
                    endGame(false, "‚è∞ ¬°Tiempo agotado!");
                }
            }, 1000);
        }

        // Sistema de pistas
        function useHint() {
            if (!gameActive || timer <= 10) return;

            initAudio();
            playSound('hint');

            // Encontrar letra no adivinada
            const unguessed = selected.split("").filter(l => !guessed.includes(l));
            if (unguessed.length === 0) return;

            // Revelar una letra aleatoria
            const hintLetter = unguessed[Math.floor(Math.random() * unguessed.length)];
            guessed.push(hintLetter);

            // Penalizaci√≥n de tiempo
            timer = Math.max(1, timer - 10);
            document.getElementById("timer-display").textContent = "Tiempo: " + timer + "s";
            updateTimerBar();

            // Marcar bot√≥n como usado
            const buttons = document.querySelectorAll("#letters button");
            buttons.forEach(btn => {
                if (btn.textContent === hintLetter) {
                    btn.disabled = true;
                    btn.classList.add("correct");
                }
            });

            drawWord();
            checkGame();

            // Deshabilitar pista si quedan pocas letras o poco tiempo
            const remaining = selected.split("").filter(l => !guessed.includes(l));
            if (remaining.length <= 1 || timer <= 10) {
                document.getElementById("hint").disabled = true;
            }
        }

        // Terminar juego
        function endGame(won, message) {
            gameActive = false;
            clearInterval(timerInterval);

            const statusEl = document.getElementById("status");

            if (won) {
                wins++;
                streak++;
                statusEl.textContent = message || "üéâ ¬°Has ganado!";
                statusEl.className = "victoria";
                playSound('victory');
            } else {
                losses++;
                streak = 0;
                statusEl.textContent = (message || "üíÄ Has perdido") + " Palabra: " + selected;
                statusEl.className = "derrota";
                playSound('defeat');
            }

            saveStats();
            updateStatsDisplay();

            document.querySelectorAll("#letters button").forEach(b => b.disabled = true);
            document.querySelectorAll('input[name="level"]').forEach(i => i.disabled = false);
            document.getElementById("hint").disabled = true;
        }

        // Comprobar fin de juego
        function checkGame() {
            const wordDiv = document.getElementById("word");

            // Victoria
            if (!wordDiv.textContent.includes("")) {
                const allRevealed = selected.split("").every(l => guessed.includes(l));
                if (allRevealed) {
                    endGame(true);
                    return;
                }
            }

            // Derrota por errores
            if (mistakes >= maxMistakes) {
                endGame(false);
            }
        }

        // Iniciar juego
        function startGame() {
            initAudio();

            guessed = [];
            mistakes = 0;
            gameActive = true;

            // Ocultar intro, mostrar info
            document.getElementById("intro-message").classList.add("hidden");
            document.getElementById("game-info").classList.remove("hidden");
            document.getElementById("timer-bar-container").classList.remove("hidden");

            selectWord();
            drawBase();
            drawWord();
            createLetters();
            updateMistakesLeft();

            document.getElementById("status").textContent = "";
            document.getElementById("status").className = "";

            document.querySelectorAll('input[name="level"]').forEach(i => i.disabled = true);
            document.getElementById("hint").disabled = false;

            startTimer();
        }

        // Event listeners
        document.getElementById("start").onclick = startGame;
        document.getElementById("restart").onclick = startGame;
        document.getElementById("hint").onclick = useHint;

        // Inicializar
        updateStatsDisplay();
        drawBase();
    </script>
</body>

</html>